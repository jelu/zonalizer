<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Zonalizer - Powered by Zonemaster</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.5/darkly/bootstrap.min.css">
    <link rel="stylesheet" href="../../zonalizer.css?8">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
    <nav class="navbar navbar-default navbar-fixed-top">
        <div class="container">

            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar-main">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <span class="navbar-brand">Zonalizer</span>
            </div>

            <div id="navbar-main" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="/">Analyze</a></li>
                    <li><a href="/browse">Browse</a></li>
                    <li class="active"><a href="/visualize">Visualize <span class="sr-only">(current)</span></a></li>
                    <li><a href="/about">About</a></li>
                </ul>
            </div>

        </div>
    </nav>

    <noscript>
        <div class="container">
            <div class="alert alert-dismissible alert-danger">
                <p class="lead text-center"><strong>JavaScript ON.. ENABLE... Oh come on!</strong></p>
            </div>
        </div>
    </noscript>

    <div id="jquery-alert" class="container" style="display: none">
        <div class="alert alert-dismissible alert-danger">
            <p class="lead text-center"><strong>Please enable jQuery!</strong></p>
        </div>
    </div>

    <div class="container">
        <div class="page-header">
            <span class="text-warning lead" style="float: right">BETA</span>
            <h1>Sunburst</h1>
        </div>

        <p>
            Select measurements:
        </p>
        <p>
            <button class="btn btn-default">Count</button>
            <button class="btn btn-primary">Total Score</button>
            <button class="btn btn-danger">Critical</button>
            <button class="btn btn-danger">Error</button>
            <button class="btn btn-warning">Warning</button>
            <button class="btn btn-info">Notice</button>
            <button class="btn btn-success">OK</button>
        </p>
    </div>

    <div class="container">
        <div id="svg" class="text-center">
        </div>

        <p>
            Click on colors to zoom in. Hover to get FQDN. Click on center to zoom out.
        </p>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <script src="../../ie10-viewport-bug-workaround.js"></script>
    <script src="../../jquery-visibility.min.js"></script>
    <script src="../../zonalizer.js?9"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <script>
        if ( typeof $ === 'function' ) {
            $( document ).ready(function () {
                $('#jquery-alert').remove();
                $(document).zonalizer('visualize');


var width = 960,
    height = 700,
    radius = (Math.min(width, height) / 2) - 10;

var x = d3.scale.linear()
    .range([0, 2 * Math.PI]);

var y = d3.scale.sqrt()
    .range([0, radius]);

var color = d3.scale.category20c();

var svg = d3.select("#svg").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + (height / 2) + ")");

var partition = d3.layout.partition()
    .sort(null)
    .value(function(d) { return 1; });

var arc = d3.svg.arc()
    .startAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x))); })
    .endAngle(function(d) { return Math.max(0, Math.min(2 * Math.PI, x(d.x + d.dx))); })
    .innerRadius(function(d) { return Math.max(0, y(d.y)); })
    .outerRadius(function(d) { return Math.max(0, y(d.y + d.dy)); });

// Keep track of the node that is currently being displayed as the root.
var node;

d3.json("sunburst.json", function(error, root) {
  node = root;
  var path = svg.datum(root).selectAll("path")
      .data(partition.nodes)
    .enter().append("path")
      .attr("d", arc)
      .style("stroke", "#fff")
      .style('stroke-width', '0')
      .style("fill", function(d) { return d.depth ? color((d.children ? d : d.parent).name) : '#222222'; })
      .on("click", click)
      .each(stash);

   path.append("title")
      .text(function(d) { return d.name });

    $('.btn:eq(0)').click(function () {
        path.data(partition.value(function (d) {
            return 1;
        }).nodes)
            .transition()
            .duration(1000)
            .attrTween("d", arcTweenData);
    });
    $('.btn:eq(1)').click(function () {
        path.data(partition.value(function (d) {
            return(
                ( d.summary.critical * 10000 )
                + ( d.summary.error * 1000 )
                + ( d.summary.warning * 10 )
                + d.summary.notice
                );
        }).nodes)
            .transition()
            .duration(1000)
            .attrTween("d", arcTweenData);
    });
    $('.btn:eq(2)').click(function () {
        path.data(partition.value(function (d) {
            return d.summary.critical;
        }).nodes)
            .transition()
            .duration(1000)
            .attrTween("d", arcTweenData);
    });
    $('.btn:eq(3)').click(function () {
        path.data(partition.value(function (d) {
            return d.summary.error;
        }).nodes)
            .transition()
            .duration(1000)
            .attrTween("d", arcTweenData);
    });
    $('.btn:eq(4)').click(function () {
        path.data(partition.value(function (d) {
            return d.summary.warning;
        }).nodes)
            .transition()
            .duration(1000)
            .attrTween("d", arcTweenData);
    });
    $('.btn:eq(5)').click(function () {
        path.data(partition.value(function (d) {
            return d.summary.notice;
        }).nodes)
            .transition()
            .duration(1000)
            .attrTween("d", arcTweenData);
    });
    $('.btn:eq(6)').click(function () {
        path.data(partition.value(function (d) {
            return d.summary.critical
                || d.summary.error
                || d.summary.warning
                || d.summary.notice
                ? 0
                : 1;
        }).nodes)
            .transition()
            .duration(1000)
            .attrTween("d", arcTweenData);
    });

  function click(d) {
    node = d;
    path.transition()
      .duration(1000)
      .attrTween("d", arcTweenZoom(d));
  }
});

d3.select(self.frameElement).style("height", height + "px");

// Setup for switching data: stash the old values for transition.
function stash(d) {
  d.x0 = d.x;
  d.dx0 = d.dx;
}

// When switching data: interpolate the arcs in data space.
function arcTweenData(a, i) {
  var oi = d3.interpolate({x: a.x0, dx: a.dx0}, a);
  function tween(t) {
    var b = oi(t);
    a.x0 = b.x;
    a.dx0 = b.dx;
    return arc(b);
  }
  if (i == 0) {
   // If we are on the first arc, adjust the x domain to match the root node
   // at the current zoom level. (We only need to do this once.)
    var xd = d3.interpolate(x.domain(), [node.x, node.x + node.dx]);
    return function(t) {
      x.domain(xd(t));
      return tween(t);
    };
  } else {
    return tween;
  }
}

// When zooming: interpolate the scales.
function arcTweenZoom(d) {
  var xd = d3.interpolate(x.domain(), [d.x, d.x + d.dx]),
      yd = d3.interpolate(y.domain(), [d.y, 1]),
      yr = d3.interpolate(y.range(), [d.y ? 20 : 0, radius]);
  return function(d, i) {
    return i
        ? function(t) { return arc(d); }
        : function(t) { x.domain(xd(t)); y.domain(yd(t)).range(yr(t)); return arc(d); };
  };
}

            });
        }
        else {
            document.getElementById('jquery-alert').style.display = 'block';
        }
    </script>

</body>
</html>
